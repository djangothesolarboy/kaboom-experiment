<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kabooooom</title>
</head>
<body>
    <script src="https://kaboomjs.com/lib/0.5.1/kaboom.js"></script>
    <script type="module">
        // initialize kaboom context
        const k = kaboom();

        //                  SPRITES
        //          name sprite     sprite location
        k.loadSprite('skele', './assets/imgs/sprites/skele/Faceset.png');

        //                  BACKGROUND SPRITES
        k.loadSprite('top-left', './assets/imgs/backgrounds/top-left.png');

        k.loadSound('blip', './assets/sounds/blip.wav');
        k.loadSound('hurt', './assets/sounds/hurt.wav');

        k.layers([
            'bg',
            'obj',
            'ui',
        ], 'obj');

        // define a scene
        k.scene("main", () => {

            // add a text at position (100, 100)
            k.add([
                k.text("menu", 32),
                k.pos(100, 100),
                k.layer('ui'),
            ]);

            k.keyPress('space', () => {
                k.play('blip', {
                    volume: 5.0
                });
                k.go('game');
            });
            
        });
        
        k.scene('game', () => {
            k.add([
                k.text('game', 32),
                k.pos(100, 100),
                k.layer('ui'),
            ]);

            const player = k.add([
                k.sprite('skele'),
                k.pos(100, 100),
                k.scale(1),
                k.body(),
                'player',
                'killable',
                { speed: 160 },
            ]);

            const map =k.addLevel([
                '========================================',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '=                                      =',
                '^                                      =',
                '=^^^^===================================',
            ], {
                width: 16,
                height: 16,
                pos: k.vec2(0, 0),
                '=': [
                    k.sprite('top-left'),
                    k.solid()
                ],
                '^': [
                    k.sprite('top-left'),
                    k.solid(),
                    'hurt'
                ]
            });

            player.collides('hurt', () => {
                k.play('hurt', {
                    volume: 5.0
                });
            });

            k.keyPress('space', () => {
                k.play('blip', {
                    volume: 5.0
                });
                k.go('main');
            });

            k.keyDown('left', () => {
                player.flipX(-1);
                player.move(-player.speed, 0);
            });

            k.keyDown('right', () => {
                player.flipX(1);
                player.move(player.speed, 0);
            });
        })

        // start the game
        k.start("main");

    </script>
</body>
</html>